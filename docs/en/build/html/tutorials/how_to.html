


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial 11: How to xxx &mdash; MMDetection  documentation</title>
  

  <link rel="shortcut icon" href="../_static/images/logo192.png" />
  
  

  

  
  
  

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/readthedocs.css" type="text/css" />
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Log Analysis" href="../useful_tools.html" />
  <link rel="prev" title="Tutorial 10: Weight initialization" href="init_cfg.html" />
  <!-- Google Analytics -->
  <script type="text/javascript">
    var collapsedSections = [];
  </script>
  
  <!-- End Google Analytics -->
  

  
  <script src="../_static/js/modernizr.min.js"></script>
  <script>
    MathJax = {
        chtml: {
            scale: 1,
            minScale: 1,
        },
        svg: {
            scale: 1,
            minScale: 1,
        }
    }
</script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"
    integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href=""
        aria-label="OpenMMLab"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://github.com/open-mmlab/mmdetection" target="_blank">GitHub</a>
          </li>
          <li >
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a
                class="resource-option with-down-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmcv.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMCV </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://openmim.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MIM </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmaction2.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMAction2 </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmclassification.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMClassification </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmdetection.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMDetection </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmdetection3d.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMDetection3D </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmediting.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMEditing </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmgeneration.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMGeneration </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmocr.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMOCR </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmpose.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMPose </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmsegmentation.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMSegmentation </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmtracking.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMTracking </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmflow.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMFlow </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmfewshot.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMFewShot </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmhuman3d.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMHuman3D </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmselfsup.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMSelfSup </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmrazor.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMRazor </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmdeploy.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMDeploy </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://mmrotate.readthedocs.io/en/latest/" target="_blank">
                  <span class="dropdown-title">MMRotate </span>
                  <p></p>
                </a>
              </div>
          </li>
          <li >
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a
                class="resource-option with-down-arrow">
                OpenMMLab
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://openmmlab.com/" target="_blank">
                  <span class="dropdown-title">Homepage </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://platform.openmmlab.com/" target="_blank">
                  <span class="dropdown-title">Open Platform </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://github.com/open-mmlab/" target="_blank">
                  <span class="dropdown-title">GitHub </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://twitter.com/OpenMMLab" target="_blank">
                  <span class="dropdown-title">Twitter </span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item"
                  href="https://zhihu.com/people/openmmlab" target="_blank">
                  <span class="dropdown-title">Zhihu </span>
                  <p></p>
                </a>
              </div>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

  

  <div class="table-of-contents-link-wrapper">
    <span>Table of Contents</span>
    <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
  </div>

  <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
    <div class="pytorch-side-scroll">
      <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <div class="pytorch-left-menu-search">
          

          
          
          
          

          



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        
        
        
        
        
        <p class="caption"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started.html#verification">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo.html">Benchmark and Model Zoo</a></li>
</ul>
<p class="caption"><span class="caption-text">Quick Run</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1_exist_data_model.html">1: Inference and train with existing models and standard datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_new_data_model.html">2: Train with customized datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_exist_data_new_model.html">3: Train with customized models and standard datasets</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="config.html">Tutorial 1: Learn about Configs</a></li>
<li class="toctree-l1"><a class="reference internal" href="customize_dataset.html">Tutorial 2: Customize Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_pipeline.html">Tutorial 3: Customize Data Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="customize_models.html">Tutorial 4: Customize Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="customize_runtime.html">Tutorial 5: Customize Runtime Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="customize_losses.html">Tutorial 6: Customize Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="finetune.html">Tutorial 7: Finetuning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytorch2onnx.html">Tutorial 8: Pytorch to ONNX (Experimental)</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx2tensorrt.html">Tutorial 9: ONNX to TensorRT (Experimental)</a></li>
<li class="toctree-l1"><a class="reference internal" href="init_cfg.html">Tutorial 10: Weight initialization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 11: How to xxx</a></li>
</ul>
<p class="caption"><span class="caption-text">Useful Tools and Scripts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html">Log Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#result-analysis">Result Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#visualization">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#error-analysis">Error Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#model-serving">Model Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#model-complexity">Model Complexity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#model-conversion">Model conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#dataset-conversion">Dataset Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#dataset-download">Dataset Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#benchmark">Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#miscellaneous">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#hyper-parameter-optimization">Hyper-parameter Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful_tools.html#confusion-matrix">Confusion Matrix</a></li>
</ul>
<p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compatibility.html">Compatibility of MMDetection 2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects.html">Projects based on MMDetection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Switch Language</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../switch_language.html"><a href='https://mmdetection.readthedocs.io/en/latest/'>English</a></a></li>
<li class="toctree-l1"><a class="reference internal" href="../switch_language.html#a-href-https-mmdetection-readthedocs-io-zh-cn-latest-a"><a href='https://mmdetection.readthedocs.io/zh_CN/latest/'>简体中文</a></a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">mmdet.apis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html#mmdet-core">mmdet.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html#mmdet-datasets">mmdet.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html#mmdet-models">mmdet.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html#mmdet-utils">mmdet.utils</a></li>
</ul>

        
        
      </div>
    </div>
  </nav>

  <div class="pytorch-container">
    <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
      <div class="pytorch-breadcrumbs-wrapper">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
            Docs
        </a> &gt;
      </li>

        
          <li><a href="index.html">&lt;no title&gt;</a> &gt;</li>
        
      <li>Tutorial 11: How to xxx</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/how_to.md.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
      </div>

      <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
        Shortcuts
      </div>
    </div>

    <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
      <div class="pytorch-content-left">
        
          <div class="rst-content">
            
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
              <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
                
  <div class="section" id="tutorial-11-how-to-xxx">
<h1>Tutorial 11: How to xxx<a class="headerlink" href="#tutorial-11-how-to-xxx" title="Permalink to this headline">¶</a></h1>
<p>This tutorial collects answers to any <code class="docutils literal notranslate"><span class="pre">How</span> <span class="pre">to</span> <span class="pre">xxx</span> <span class="pre">with</span> <span class="pre">MMDetection</span></code>. Feel free to update this doc if you meet new questions about <code class="docutils literal notranslate"><span class="pre">How</span> <span class="pre">to</span></code> and find the answers!</p>
<div class="section" id="use-backbone-network-through-mmclassification">
<h2>Use backbone network through MMClassification<a class="headerlink" href="#use-backbone-network-through-mmclassification" title="Permalink to this headline">¶</a></h2>
<p>The model registry in MMDet, MMCls, MMSeg all inherit from the root registry in MMCV. This allows these repositories to directly use the modules already implemented by each other. Therefore, users can use backbone networks from MMClassification in MMDetection without implementing a network that already exists in MMClassification.</p>
<div class="section" id="use-backbone-network-implemented-in-mmclassification">
<h3>Use backbone network implemented in MMClassification<a class="headerlink" href="#use-backbone-network-implemented-in-mmclassification" title="Permalink to this headline">¶</a></h3>
<p>Suppose you want to use <code class="docutils literal notranslate"><span class="pre">MobileNetV3-small</span></code> as the backbone network of <code class="docutils literal notranslate"><span class="pre">RetinaNet</span></code>, the example config is as the following.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_base_</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;../_base_/models/retinanet_r50_fpn.py&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../_base_/datasets/coco_detection.py&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../_base_/schedules/schedule_1x.py&#39;</span><span class="p">,</span> <span class="s1">&#39;../_base_/default_runtime.py&#39;</span>
<span class="p">]</span>
<span class="c1"># please install mmcls&gt;=0.20.0</span>
<span class="c1"># import mmcls.models to trigger register_module in mmcls</span>
<span class="n">custom_imports</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">imports</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mmcls.models&#39;</span><span class="p">],</span> <span class="n">allow_failed_imports</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pretrained</span> <span class="o">=</span> <span class="s1">&#39;https://download.openmmlab.com/mmclassification/v0/mobilenet_v3/convert/mobilenet_v3_small-8427ecf0.pth&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">backbone</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">_delete_</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Delete the backbone field in _base_</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;mmcls.MobileNetV3&#39;</span><span class="p">,</span> <span class="c1"># Using MobileNetV3 from mmcls</span>
        <span class="n">arch</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span>
        <span class="n">out_indices</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="c1"># Modify out_indices</span>
        <span class="n">init_cfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Pretrained&#39;</span><span class="p">,</span>
            <span class="n">checkpoint</span><span class="o">=</span><span class="n">pretrained</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;backbone.&#39;</span><span class="p">)),</span> <span class="c1"># The pre-trained weights of backbone network in MMCls have prefix=&#39;backbone.&#39;. The prefix in the keys will be removed so that these weights can be normally loaded.</span>
    <span class="c1"># Modify in_channels</span>
    <span class="n">neck</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">96</span><span class="p">],</span> <span class="n">start_level</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="use-backbone-network-in-timm-through-mmclassification">
<h3>Use backbone network in TIMM through MMClassification<a class="headerlink" href="#use-backbone-network-in-timm-through-mmclassification" title="Permalink to this headline">¶</a></h3>
<p>MMClassification also provides a wrapper for the PyTorch Image Models (timm) backbone network, users can directly use the backbone network in timm through MMClassification. Suppose you want to use EfficientNet-B1 as the backbone network of RetinaNet, the example config is as the following.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://github.com/open-mmlab/mmdetection/blob/master/configs/timm_example/retinanet_timm_efficientnet_b1_fpn_1x_coco.py</span>

<span class="n">_base_</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;../_base_/models/retinanet_r50_fpn.py&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../_base_/datasets/coco_detection.py&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../_base_/schedules/schedule_1x.py&#39;</span><span class="p">,</span> <span class="s1">&#39;../_base_/default_runtime.py&#39;</span>
<span class="p">]</span>

<span class="c1"># please install mmcls&gt;=0.20.0</span>
<span class="c1"># import mmcls.models to trigger register_module in mmcls</span>
<span class="n">custom_imports</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">imports</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mmcls.models&#39;</span><span class="p">],</span> <span class="n">allow_failed_imports</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">backbone</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">_delete_</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Delete the backbone field in _base_</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;mmcls.TIMMBackbone&#39;</span><span class="p">,</span> <span class="c1"># Using timm from mmcls</span>
        <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;efficientnet_b1&#39;</span><span class="p">,</span>
        <span class="n">features_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">out_indices</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="c1"># Modify out_indices</span>
    <span class="n">neck</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">320</span><span class="p">]))</span> <span class="c1"># Modify in_channels</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SGD&#39;</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">type='mmcls.TIMMBackbone'</span></code> means use the <code class="docutils literal notranslate"><span class="pre">TIMMBackbone</span></code> class from MMClassification in MMDetection, and the model used is <code class="docutils literal notranslate"><span class="pre">EfficientNet-B1</span></code>, where <code class="docutils literal notranslate"><span class="pre">mmcls</span></code> means the MMClassification repo and <code class="docutils literal notranslate"><span class="pre">TIMMBackbone</span></code> means the TIMMBackbone wrapper implemented in MMClassification.</p>
<p>For the principle of the Hierarchy Registry, please refer to the <a class="reference external" href="https://github.com/open-mmlab/mmcv/blob/master/docs/en/understand_mmcv/registry.md#hierarchy-registry">MMCV document</a>. For how to use other backbones in MMClassification, you can refer to the <a class="reference external" href="https://github.com/open-mmlab/mmclassification/blob/master/docs/en/tutorials/config.md">MMClassification document</a>.</p>
</div>
</div>
<div class="section" id="use-mosaic-augmentation">
<h2>Use Mosaic augmentation<a class="headerlink" href="#use-mosaic-augmentation" title="Permalink to this headline">¶</a></h2>
<p>If you want to use <code class="docutils literal notranslate"><span class="pre">Mosaic</span></code> in training, please make sure that you use <code class="docutils literal notranslate"><span class="pre">MultiImageMixDataset</span></code> at the same time. Taking the ‘Faster R-CNN’ algorithm as an example, you should modify the values of <code class="docutils literal notranslate"><span class="pre">train_pipeline</span></code> and <code class="docutils literal notranslate"><span class="pre">train_dataset</span></code> in the config as below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># Open configs/faster_rcnn/faster_rcnn_r50_fpn_1x_coco.py directly and add the following fields
data_root = &#39;data/coco/&#39;
dataset_type = &#39;CocoDataset&#39;
img_scale=(1333, 800)​
img_norm_cfg = dict(
    mean=[123.675, 116.28, 103.53], std=[58.395, 57.12, 57.375], to_rgb=True)

train_pipeline = [
    dict(type=&#39;Mosaic&#39;, img_scale=img_scale, pad_val=114.0),
    dict(
        type=&#39;RandomAffine&#39;,
        scaling_ratio_range=(0.1, 2),
        border=(-img_scale[0] // 2, -img_scale[1] // 2)), # The image will be enlarged by 4 times after Mosaic processing,so we use affine transformation to restore the image size.
    dict(type=&#39;RandomFlip&#39;, flip_ratio=0.5),
    dict(type=&#39;Normalize&#39;, **img_norm_cfg),
    dict(type=&#39;Pad&#39;, size_divisor=32),
    dict(type=&#39;DefaultFormatBundle&#39;),
    dict(type=&#39;Collect&#39;, keys=[&#39;img&#39;, &#39;gt_bboxes&#39;, &#39;gt_labels&#39;])
]

train_dataset = dict(
    _delete_ = True, # remove unnecessary Settings
    type=&#39;MultiImageMixDataset&#39;,
    dataset=dict(
        type=dataset_type,
        ann_file=data_root + &#39;annotations/instances_train2017.json&#39;,
        img_prefix=data_root + &#39;train2017/&#39;,
        pipeline=[
            dict(type=&#39;LoadImageFromFile&#39;),
            dict(type=&#39;LoadAnnotations&#39;, with_bbox=True)
        ],
        filter_empty_gt=False,
    ),
    pipeline=train_pipeline
    )
​
data = dict(
    train=train_dataset
    )
</pre></div>
</div>
</div>
</div>


              </article>
              
            </div>
            <footer>
  
  <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
    
    <a href="../useful_tools.html" class="btn btn-neutral float-right" title="Log Analysis" accesskey="n"
      rel="next">Next <img src="../_static/images/chevron-right-blue.svg"
        class="next-page"></a>
    
    
    <a href="init_cfg.html" class="btn btn-neutral" title="Tutorial 10: Weight initialization" accesskey="p"
      rel="prev"><img src="../_static/images/chevron-right-blue.svg" class="previous-page"> Previous</a>
    
  </div>
  

  <hr>

  <div role="contentinfo">
    <p>
      &copy; Copyright 2018-2021, OpenMMLab.

    </p>
  </div>
  
  <div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a
      href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the
      Docs</a>.
  </div>
   

</footer>
          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Tutorial 11: How to xxx</a><ul>
<li><a class="reference internal" href="#use-backbone-network-through-mmclassification">Use backbone network through MMClassification</a><ul>
<li><a class="reference internal" href="#use-backbone-network-implemented-in-mmclassification">Use backbone network implemented in MMClassification</a></li>
<li><a class="reference internal" href="#use-backbone-network-in-timm-through-mmclassification">Use backbone network in TIMM through MMClassification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-mosaic-augmentation">Use Mosaic augmentation</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
    </section>
  </div>

  


  

  
  <script type="text/javascript" id="documentation_options" data-url_root="../"
    src="../_static/documentation_options.js"></script>
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
  <script src="../_static/jquery.js"></script>
  <script src="../_static/underscore.js"></script>
  <script src="../_static/doctools.js"></script>
  <script src="../_static/clipboard.min.js"></script>
  <script src="../_static/copybutton.js"></script>
  

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
  </div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="" aria-label="OpenMMLab"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://github.com/open-mmlab/mmdetection" target="_blank">GitHub</a>
          </li>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function () {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function (e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>

</html>